# New Directions in PTO

This document summarises the discussion held between (in alphabetical order)

* Roman MÃ¼ntener,
* Stephan Neuhaus, and
* Brian Trammell

on 2016-12-19, 11:30--12:30 via Skype.

## Changes to the PTO-UI

* Separate "Path Criteria" and "Time" into different tabs
* In "Time", offer defaults for given year (e.g., "2015") or given month of given year (e.g., "June 2016"), time range of given measurement campaign (e.g., "ecnspider-june-2016") with the semantics that this will just restrict the time to that interval, but not restrict the data to observations generated from that one measurement campaign.
* Offer to group by condition, e.g., selecting `ecn.*` will create a table where the various ECN conditions are displayed and counted.
* Submission and rendering of query now asynchronous (see below)

## Changes to PTO-Core

### Asynchronous Submission and Rendering of Queries

Once a query is submitted, a URL is immediately returned. A HTTP `GET` on that URL gives either a "not done yet, come back later" response or a JSON result that is rendered in the UI. Rendering the result presents a "make permanent" button. If that button is pressed, the JSON result is permanently stored under that URL. If that button is not pressed, the (temporary) result is deleted after a reasonable time.

### Counting Queries

In order to generate tables, PTO-Core (and IQL) should be able to execute counting queries. It is known that these queries can last long, but it is hoped that asynchronous submission and rendering will defuse that problem (see above).

The counts should be groupable by condition (see "Changes to PTO-UI" above) and time series, and also by country code. It may be useful to be able to group by additional auxiliary property of, e.g., the target IP, but that may be a function of either the UI or the analyser. Such an additional property might be the target's AS number.

A medium-term goal (to be completed before the next review in October 2017) is to generate colourful world maps based on observations, for questions like "which countries impair ECN the most?".

## Short-Term Work for the Observatory's Go-Live

One problem with pto-core is that it is designed for production-only. There are no provisions for rectifying problems resulting from buggy analysers. Therefore the following changes to the PTO architecture will have to be implemented:

* There is an API call that nukes all observations coming out of a particular analyser run
* There us an API call that deprecates all observations out of a particular analyser run

Both of these calls need to be cascading, in the sense that all observations based on nuked/deprecated observations need also to be nuked/deprecated.

* Take a set of uploads and feed them to an analyser to generate observations
* Take a set of observations and feed them to an analyser to generate observations

These are not time-critical. For the go-live of the observatory's public-facing part, the following work has to be done:

* Generate the ultimate observations form the ECN data (TBD by 2017-01-20)

## Jupyterhub

The Jupyterhub arrangement should be changed to enable exploratory analysis as follows:

* There is _one_ Python import that imports pto-core and Apache spark, contains read-only access to the observatory, and has read-write access to a special database created just for this user.
* Ther is a manual step that takes observtions generated by a Jupyterhub session and puts it into the main observatory.