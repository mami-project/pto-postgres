<!DOCTYPE html>
<html>
<title>Path Transparency Observatory - Query</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">
<link rel="stylesheet" href="css.css">
<script scr="layout.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="cfg.js"></script>
<script type="text/javascript">
      function disableDays(set) {
        console.log('disableDays',set);
        disableDaysFor(set, 'i_day_from', $('#i_year_from').val(), $('#i_month_from').val());
        disableDaysFor(set, 'i_day_to', $('#i_year_to').val(), $('#i_month_to').val());
      }

      function disableDaysFor(set, select, year, month) {
        var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];

        month = months.indexOf(month);

        if(typeof(year) == 'string') year = parseInt(year);

        var lastDay = new Date(Date.UTC(year, month+1,0)).getUTCDate();

        console.log('lastDay', lastDay, year, month);

        for(var i = 1; i <= 31; i++) {
          var i_s = i.toString();
          
          if(i_s.length < 2)
            i_s = '0' + i_s;

          var prop_value = undefined;
          if(i <= lastDay)
            prop_value = false;
          else
            prop_value = true;
          
          $('#'+select + ' option[value="' + i_s + '"]').prop('disabled', prop_value);



          if(select == 'i_day_to') {
            if(i == lastDay) {
              if(set) {
                $('#'+select + ' option[value="' + i_s + '"]').prop('selected', true);
              }
            } else {
              if(set) {
                $('#'+select + ' option[value="' + i_s + '"]').prop('selected', false);
              }
            }
          }

          if(select == 'i_day_from') {
            if(i == 1) {
              if(set) {
                $('#'+select + ' option[value="' + i_s + '"]').prop('selected', true);
              }
            } else {
              if(set) {
                $('#'+select + ' option[value="' + i_s + '"]').prop('selected', false);
              }
            }
          }
        }
      }
</script>
<script src="iql.js"></script>
<script src="results.js"></script>
<script src="qui.js"></script>
<body>

<!-- Navbar -->
<div class="w3-top">
  <div class="w3-bar w3-black w3-card-2 w3-left-align w3-large">
    <a class="w3-bar-item w3-button w3-hide-medium w3-hide-large w3-right w3-padding-large w3-hover-white w3-large w3-red" href="javascript:void(0);" onclick="myFunction()" title="Toggle Navigation Menu"><i class="fa fa-bars"></i></a>
    <a href="index.html" class="w3-bar-item w3-button w3-padding-large w3-hover-white">Home<!--<image src="img/pto.png" style="max-height:41px"/>--></a>
    <a href="qui.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-white">Run Query</a>
    <a href="qq.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white">Query Queue</a>
    <a href="uploadstats.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white">Upload statistics</a>
  </div>
  
  <!-- Navbar on small screens -->
  <div id="navDemo" class="w3-bar-block w3-white w3-hide w3-hide-large w3-hide-medium w3-large">
    <a href="qui.html" class="w3-bar-item w3-button w3-padding-large">Run Query</a>
    <a href="qq.html" class="w3-bar-item w3-button w3-padding-large">Query Queue</a>
    <a href="uploadstats.html" class="w3-bar-item w3-button w3-padding-large">Upload statistics</a>
  </div>
</div>
  

<!--
<header class="w3-container w3-theme w3-padding" id="myHeader">
  <div class="w3-center">
  <h4>Path Transparency Observatory</h4>
  <h1 class="w3-xxxlarge"><b>P</b>ath <b>T</b>ransparency <b>O</b>bservatory</h1>
    <p><image src="img/pto-black.png" /></p>
    <p>An open-source, public repository for measurement of path transparency and <br>
    impairments on new and existing network protocols in the Internet.</p>
    <div class="w3-padding-32">
      <button class="w3-btn w3-xlarge w3-dark-grey w3-hover-light-grey" onclick="document.getElementById('id01').style.display='block'" style="font-weight:900;">Query Observations</button>
    </div>
  </div>
</header>

<div id="id01" class="w3-modal">
    <div class="w3-modal-content w3-card-4 w3-animate-top">
      <header class="w3-container w3-theme-l1"> 
        <span onclick="document.getElementById('id01').style.display='none'"
        class="w3-button w3-display-topright">X</span>
        <h4>Query</h4>
      </header>
      <div class="w3-padding">
        <p>Query</p>
        <p><a class="w3-btn" href="/w3css/default.asp">conditions</a></p>
      </div>
      <footer class="w3-container w3-theme-l1">
        <p>Done</p>
      </footer>
    </div>
</div>-->

    <div id="dialog-overlay"></div>
	<div id="dialog-box">
	  <a href="#close" title="Close" class="close">x</a>
	  <div class="dialog-content">
	    <div id="dialog-message"></div>
		<a href="#" class="button">Okay</a>
	  </div>
	</div>
	<div id="dialog-conditions">
	  <a href="#close" title="Close" class="close">x</a>
	  <div class="dialog-content">
	    <div>
	    <h3>Overview of current conditions for observations in the PTO</h3>
	    <table>
	    <tr><td colspan=2><b>Condition</b></td><td><b>Description</b></td></tr>
	    <tr><td rowspan=4 valign=top>ecn.connectivity.</td><td>works</td><td>TCP connections with and without ECN were established successfully.</td></tr>
	    <tr><td>broken</td><td>A TCP connection without ECN negotiation attempt was established, but not with ECN.</td></tr>
	    <tr><td>transient</td><td>A TCP connection with ECN negotiation was established, but not without. Since there is no reasonable model for a host that only responds
to ECN-enable TCP handshakes at this time, we clearly consider this case as a transient measurement error.</td></tr>
	    <tr><td>offline</td><td>No connection attempt to
the target succeeded.</td></tr>
<tr><td rowspan=2 valign=top>ecn.connectivity.super</td><td>works, broken, transient, offline</td><td>Each corresponding condition has been observed three times in three parallel trials.</td></tr>
<tr><td>weird</td><td>Different conditions have been observed in the three parallel trials.</td></tr>
        <tr><td rowspan=2 valign=top>ecn.negotiation_attempt.</td><td>succeeded</td><td>ECN was successfully negotiated.</td></tr>
	    <tr><td>failed</td><td>A TCP connection with ECN negotiation attempt was established, but ECN was not successfully negotiated.</td></tr>
	    <tr><td rowspan=3 valign=top>ecn.ipmark.</td><td>ce.seen</td><td>At least one CE mark observed on this connection.</td></tr>
	    <tr><td>ect_zero.seen</td><td>At least one ECT(0) mark observed on this connection.</td></tr>
	    <tr><td>ect_zero.seen</td><td>At least one ECT(1) mark observed on this connection.</td></tr>
	    <tr><td rowspan=3 valign=top>ecn.path_dependent.</td><td>weak</td><td>A host is flagged as weakly path dependent if their is at least one <i>works</i> and at least one <i>broken</i> super condition for it from different vantage points.</td></tr>
	    <tr><td>strict</td><td>A host is flagged as strictly path dependent if it is weakly path dependent and there are no <i>transient</i>, <i>offline</i>, or <i>weird</i> super conditions for it.</td></tr>
	    <tr><td>strong</td><td>A host is flagged as strongly path dependent if it is strictly path dependent but there are at least two <i>broken</i> super conditions associated with it.</td></tr>
	    <tr><td rowspan=2 valign=top>ecn.side_dependent.</td><td>weak</td><td>A host is flagged as weakly site dependent, if there are <i>broken</i> but no <i>works</i> and no <i>transient</i> super conditions associated with it.</td></tr>
	    <tr><td>strong</td><td>A host is flagged as strongly site dependent, if there are only <i>broken</i> super conditions for it.</td></tr>
	    </table>
	    </div>
	  </div>
	</div>


<br>
    <div id="container">
      <div id="main">
      <div id="qui">
        <div id="run_query">
        <h1>Custom Query</h1>
        <div class="msg" id="query_msg">
          Please specify your query criteria 
          and then click on 'Run Query' to submit the query. 
          Your query will be submitted to a queue and 
          you'll be provided a link to retrieve the results. 
        </div>
        </div>
        <div id="results_msg_top" style="display: none">
        </div>
        <br>
        <form action="javascript:runQuery();">
          <fieldset>
            <legend>Query</legend>
            <div class="row-2">
              <div class="cell">
                <label>Conditions
                <img  class="clickimg" src="information-circle.jpg" height="15px" onclick="popupdialog('conditions')">
                </label>
              </div>
              <div class="cell">
                <select id="i_conditions">
                  <option value="ecn.connectivity">ecn.connectivity.(works, broken, offline, transient)</option>
                  <option value="ecn.connectivity.super">ecn.connectivity.super.(works, broken, offline, transient, weird)</option>
                  <option value="ecn.ipmark.ce">ecn.ipmark.ce.(seen)</option>
                  <option value="ecn.ipmark.ect_one">ecn.ipmark.ect_one.(seen)</option>
                  <option value="ecn.ipmark.ect_zero">ecn.ipmark.ect_zero.(seen)</option>
                  <option value="ecn.negotiation_attempt">ecn.negotiation_attempt.(succeeded, failed), </option>
                  <option value="ecn.site_dependent">ecn.site_dependent.(weak, strict, strong)</option>
                  <option value="ecn.path_dependent">ecn.path_dependent.(weak, strong)</option>
                </select>
              </div>
            </div>
            <div class="row-2">
              <div class="cell">
                <label>Count</label>
              </div>
              <div class="cell">
				  <div class="row-3">
					  <div class="cell">
						<select id="i_count" <!--onchange="hideGroups()"-->>
						  <option value="no" selected>Observations</option>
						  <!--<option value="full_path">Paths</option>-->
						  <option value="target">Targets</option>
						  <option value="source">Vantage points</option>
						  <!--<option value="observation_set">Observation sets</option>-->
						  <!--<option value="name">Conditions</option>-->
						  <!--<option value="no_">Don't count</option>-->
						</select>
					  </div>
					  <div class="mylabel">
						<label>per</label>
					  </div>
					  <div class="cell">
						<select id="i_per" disabled onchange="disableSelection()">
						  <option value="name" selected>Condition</option>
						  <option value="week">Week</option>
						  <option value="month">Month</option>
						  <option value="year">Year</option>
						  <!--<option value="full_path">Path</option>-->
						  <option value="target">Target</option>
						  <option value="source">Vantage point</option>
						  <!--<option value="no">globally (don't group)</option>-->
						</select>
					  </div>
					  <div class="lock">
						<img class="clickimg" src="unlock.png" height="100%" onclick="unlockPer()">
					  </div>
				  </div>
              </div>
            </div>
            </fieldset>
            <fieldset>
            <legend>Grouping (optional)
            <img class="clickimg" id="hideshow3" src="hide.png" onclick="togglebutton(['hideshow3', 'group_by','then_by', 'group_text'])">
            </legend>
            <p id="c_group_text">Select additional criteria to group the results data (in separate rows in results table and as input for graphical representation) or leave empty.<br><br></p>
            <div class="row-2" id="c_group_by">
              <div class="cell">
                <label>1. level </label>
              </div>
              <div class="cell">
                <select id="i_group_by" onchange="showThenBy()">
                  <option value="observation_set">Observation set</option>
                  <!--<option value="full_path">Path</option>-->
                  <option value="name" disabled>Condition</option>
                  <option value="week">Week</option>
                  <option value="month">Month</option>
                  <option value="year">Year</option>
                  <!--<option value="location">Location</option>-->
                  <option value="target">Target</option>
                  <option value="source">Vantage point</option>
                  <option value="no" selected></option>
                </select>
              </div>
            </div>
            <div class="row-2" id="c_then_by" style="display:none">
              <div class="cell">
                <label>2. level</label>
              </div>
              <div class="cell">
                <select id="i_then_by">
                  <option value="observation_set">Observation set</option>
                  <!--<option value="full_path">Path</option>-->
                  <option value="name" disabled>Condition</option>
                  <option value="week">Week</option>
                  <option value="month">Month</option>
                  <option value="year">Year</option>
                  <!--<option value="location">Location</option>-->
                  <option value="target">Target</option>
                  <option value="source">Source</option>
                  <option value="no" selected></option>
                </select>
              </div>
            </div>   
          </fieldset>
          <fieldset>
            <legend>Time window<!-- (optional)
            <img class="clickimg" id="hideshow1" src="hide.png" onclick="togglebutton(['hideshow1', 'time_to','time_from'])">-->
            </legend>
            <!--<p id="c_time_text">Accepted formats are <i>ISO 8601</i> and <i>RFC 2822</i>.<br><br></p>-->
            <div class="row-2" id="c_time_from">
              <div class="cell">
                <label>From</label>
              </div>
              <div class="cell">
                <div class="row-3">
                  <div class="mylabel">
                    <label>Year</label>
                  </div>
				          <div class="cell">
                    <select onchange="disableDays(true);" id="i_year_from">
                      <option value="2016">2016</option>
                      <option value="2017">2017</option>
                    </select>
                  </div>
                  <div class="mylabel">
                    <label>Month</label>
                  </div>
				          <div class="cell">
                    <select onchange="disableDays(true);" id="i_month_from">
                      <!--<option value="Jan">-</option>-->
                      <option value="Jan">January</option>
                      <option value="Feb">February</option>
                      <option value="Mar">March</option>
                      <option value="Apr">April</option>
                      <option value="May">May</option>
                      <option value="Jun">June</option>
                      <option value="Jul">July</option>
                      <option value="Aug">August</option>
                      <option value="Sep">September</option>
                      <option value="Oct" selected>October</option>
                      <option value="Nov">November</option>
                      <option value="Dec">December</option>
                    </select>
                  </div>
                  <div class="mylabel">
                    <label>Day</label>
                  </div>
				          <div class="cell">
                    <select id="i_day_from">
                    </select>
                  </div>
                </div>
                <!--<input id="i_time_from" type="text" value="01 Jan 1970 00:00:00 GMT"/><br>
                <span class="input_info">Leave blank for no restriction.</span>-->
              </div>
            </div>
            <div class="row-2" id="c_time_to">
              <div class="cell">
                <label>To</label>
              </div>
              <div class="cell">
                <div class="row-3">
                  <div class="mylabel">
                    <label>Year</label>
                  </div>
				          <div class="cell">
                    <select onchange="disableDays(true);" id="i_year_to">
                      <option value="2016">2016</option>
                      <option value="2017"selected>2017</option>
                    </select>
                  </div>
                  <div class="mylabel">
                    <label>Month</label>
                  </div>
				          <div class="cell">
                    <select onchange="disableDays(true);" id="i_month_to">
                      <!--<option value="Jan">-</option>-->
                      <option value="Jan" selected>January</option>
                      <option value="Feb">February</option>
                      <option value="Mar">March</option>
                      <option value="Apr">April</option>
                      <option value="May">May</option>
                      <option value="Jun">June</option>
                      <option value="Jul">July</option>
                      <option value="Aug">August</option>
                      <option value="Sep">September</option>
                      <option value="Oct">October</option>
                      <option value="Nov">November</option>
                      <option value="Dec">December</option>
                    </select>
                  </div>
                  <div class="mylabel">
                    <label>Day</label>
                  </div>
				          <div class="cell">
                    <select id="i_day_to">
                    </select>
                  </div>
                </div>
                <!--<input id="i_time_to" type="text" value="31 Dec 2037 22:59:59 GMT"/><br>
                <span class="input_info">Leave blank for no restriction.</span>-->
              </div>
            </div>
          </fieldset>
          <fieldset>
            <legend>Path criteria (optional)
            <img class="clickimg" id="hideshow2" src="hide.png" onclick="togglebutton(['hideshow2', 'target','source', 'path_text'])">
            </legend>
            <p id="c_path_text">Leave blank for no restriction.<br><br></p>
            <div class="row-2" id="c_source">
              <div class="cell">
                <label>Vantage Point</label>
              </div>
              <div class="cell">
                <div class="row-2">
                  <div class="cell">
                    <input type="radio" name="source" value="ip"> IP-address <br>
                    <input type="radio" name="source" value="asn"> AS-number <br>
                    <input type="radio" name="source" value="id"> Name/identifier string <br>
                  </div>
				          <div class="cell">
                    <input id="i_source" type="text"/>
                  </div>
                </div>
              </div>
            </div>
            <div class="row-2" id="c_target">
              <div class="cell">
                <label>Target</label>
              </div>
              <div class="cell">
                <div class="row-2">
                  <div class="cell">
                    <input type="radio" name="target" value="ip"> IP-address <br>
                    <input type="radio" name="target" value="asn"> AS-number <br>
                    <input type="radio" name="target" value="id"> Name/identifier string <br>
                  </div>
				          <div class="cell">
                    <input id="i_target" type="text"/>
                  </div>
                </div>
              </div>
            </div>
          </fieldset>
          <div class="margin-top-bottom">
          <button type="submit" id="runbutton" class="">Run query</button>
          </div>
        </form>
      </div>
      <div id="results" style="display: none">
        <h1>Query Result</h1>
        <div id="results_msg" style="display: none">
        </div>
        <div id="chart_section">
          <h2>Chart</h2>
          <div id="figures">
          </div>
        </div>
     
        <div id="table_section">
          <h2>Raw table</h2>
          <div class="auto-overflow" id="tables">
          </div>
        </div>

        <div id="raw_query_section">
          <h2>Query</h2>
          <div class="auto-overflow">
            <code id="raw_query"></code>
          </div>
        </div>

        <div id="raw_results_section">
          <h2>Raw response</h2>
          <div class="auto-overflow" id="raw_results">
          </div>
        </div>
      </div>
      </div>
    </div>

<hr>
<h2 class="w3-center">Buttons</h2>
<div class="w3-center">
  <br>
  <a class="w3-button w3-theme">Button</a>
  <a class="w3-button w3-theme">Button</a>
  <a class="w3-button w3-theme-d3 w3-disabled">Button</a>
  <br><br>
  <a class="w3-button w3-circle w3-large w3-black"><i class="fa fa-plus"></i></a>
  <a class="w3-button w3-circle w3-large w3-theme"><i class="fa fa-plus"></i></a>  
  <a class="w3-button w3-circle w3-large w3-card-4"><i class="fa fa-plus"></i></a>
</div>
<br>
<div class="w3-center">
  <div class="w3-dropdown-hover">
    <button class="w3-button w3-theme">Dropdown <i class="fa fa-caret-down"></i></button>
    <div class="w3-dropdown-content w3-bar-block w3-border">
      <a href="#" class="w3-bar-item w3-button">Link 1</a>
      <a href="#" class="w3-bar-item w3-button">Link 2</a>
      <a href="#" class="w3-bar-item w3-button">Link 3</a>
    </div>
  </div>
</div>

</div>

<hr>
<div class="w3-center">
  <h2>Pagination</h2>
  <!-- Pagination -->
  <div class="w3-center w3-padding-32">
    <div class="w3-bar">
      <a href="#" class="w3-bar-item w3-button w3-hover-theme">Â«</a>
      <a href="#" class="w3-bar-item w3-button w3-theme w3-hover-theme">1</a>
      <a href="#" class="w3-bar-item w3-button w3-hover-theme">2</a>
      <a href="#" class="w3-bar-item w3-button w3-hover-theme">3</a>
      <a href="#" class="w3-bar-item w3-button w3-hover-theme">4</a>
      <a href="#" class="w3-bar-item w3-button w3-hover-theme">5</a>
      <a href="#" class="w3-bar-item w3-button w3-hover-theme">Â»</a>
    </div>
  </div>
</div>
<br>

<!-- Footer -->
<footer class="w3-container w3-theme-dark w3-padding-16">
  <h3>Footer</h3>
  <p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" target="_blank">w3.css</a></p>
  <div style="position:relative;bottom:55px;" class="w3-tooltip w3-right">
    <span class="w3-text w3-theme-light w3-padding">Go To Top</span>    
    <a class="w3-text-white" href="#myHeader"><span class="w3-xlarge">
    <i class="fa fa-chevron-circle-up"></i></span></a>
  </div>
  <p>Remember to check out our  <a href="w3css_references.asp" class="w3-btn w3-theme-light" target="_blank">W3.CSS Reference</a></p>
</footer>


</body>
</html>
